<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Recep√ß√£o - Triagem</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f4f4; padding: 20px; max-width: 800px; margin: auto; }
        .input-group { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 15px; }
        
        input[type="text"], select { padding: 12px; font-size: 1.1rem; border: 1px solid #ccc; border-radius: 4px; text-transform: uppercase; }
        
        /* Estilo do Checkbox de Prioridade */
        .priority-wrapper { display: flex; align-items: center; gap: 10px; font-weight: bold; color: #d35400; background: #fdebd0; padding: 10px; border-radius: 5px; }
        input[type="checkbox"] { transform: scale(1.5); cursor: pointer; }

        button.btn-add { padding: 12px; background-color: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 1.1rem; }
        button.btn-add:hover { background-color: #219150; }
        
        ul { list-style: none; padding: 0; margin-top: 20px; }
        li { background: white; border-bottom: 1px solid #eee; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; }
        
        .info-container { display: flex; align-items: center; gap: 10px; flex: 1; }
        .tag { font-size: 0.8rem; padding: 4px 8px; border-radius: 4px; background: #eee; color: #555; font-weight: bold; text-transform: uppercase; }
        
        /* Icone de Prioridade na Lista */
        .badge-priority { background-color: #d35400; color: white; font-size: 0.7rem; padding: 2px 5px; border-radius: 3px; vertical-align: middle; margin-left: 5px; }

        .btn-trash { background: none; border: none; cursor: pointer; font-size: 1.2rem; }
        .btn-trash:hover { transform: scale(1.2); }
        
        #restoreArea { display: none; margin-top: 20px; padding: 15px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24; }
    </style>
</head>
<body>

    <h2>RECEP√á√ÉO</h2>
    
    <div class="input-group">
        <label>NOME:</label>
        <input type="text" id="nameInput" placeholder="EX: MARIA DA SILVA" autofocus>

        <label>ENCAMINHAR PARA:</label>
        <select id="sectorInput">
            <option value="estagio">EST√ÅGIO</option>
            <option value="terceirizados">TERCEIRIZADOS (SALA A1)</option>
            <option value="frequencia">FREQU√äNCIA (SALA A3)</option>
            <option value="lotacao">LOTA√á√ÉO (SALA A4)</option>
            <option value="ferias">F√âRIAS / RH (SALA A5)</option>
        </select>

        <div class="priority-wrapper">
            <input type="checkbox" id="priorityInput">
            <label for="priorityInput">ATENDIMENTO PRIORIT√ÅRIO (Lei 10.048)</label>
        </div>

        <button class="btn-add" onclick="addPerson()">CADASTRAR (+)</button>
    </div>

    <div id="restoreArea">
        <strong>‚ö†Ô∏è Servidor Reiniciou!</strong> Restaurar fila salva?
        <button onclick="restoreQueue()">SIM</button> <button onclick="ignoreBackup()">N√ÉO</button>
    </div>

    <h3>FILA DE ESPERA (<span id="count">0</span>)</h3>
    <ul id="queueList"></ul>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const nameInput = document.getElementById('nameInput');
        const sectorInput = document.getElementById('sectorInput');
        const priorityInput = document.getElementById('priorityInput'); // Checkbox
        const queueList = document.getElementById('queueList');
        const restoreArea = document.getElementById('restoreArea');

        setInterval(() => { socket.emit('ping-keep-alive'); }, 1000 * 60 * 5);

        function addPerson() {
            const nome = nameInput.value.trim().toUpperCase();
            const index = sectorInput.selectedIndex;
            const setorCodigo = sectorInput.value;
            const setorNome = sectorInput.options[index].text; 
            const prioridade = priorityInput.checked; // Pega valor true/false

            if (nome) {
                // Envia dados completos
                socket.emit('add-to-queue', { nome, setorCodigo, setorNome, prioridade });
                
                nameInput.value = '';
                priorityInput.checked = false; // Reseta checkbox
                nameInput.focus();
            }
        }

        function removePerson(idMongo) {
            if(confirm('Remover esta pessoa?')) {
                socket.emit('remove-from-queue', idMongo);
            }
        }

        nameInput.addEventListener("keypress", (e) => { if (e.key === "Enter") addPerson(); });

        socket.on('update-queue', (lista) => {
            document.getElementById('count').innerText = lista.length;
            queueList.innerHTML = "";
            
            lista.forEach((pessoa, i) => {
                const li = document.createElement('li');
                // Se for prioridade, adiciona estrela ‚≠ê
                const iconPrioridade = pessoa.prioridade ? '<span class="badge-priority">‚≠ê PRIORIDADE</span>' : '';
                
                li.innerHTML = `
                    <div class="info-container">
                        <strong>${i + 1}.</strong> ${pessoa.nome} ${iconPrioridade}
                        <span class="tag ${pessoa.setorCodigo}">${pessoa.setorNome}</span>
                    </div>
                    <button class="btn-trash" onclick="removePerson('${pessoa._id}')">üóëÔ∏è</button>
                `;
                queueList.appendChild(li);
            });

            // Backup Autom√°tico
            if (lista.length > 0) {
                localStorage.setItem('backupFila', JSON.stringify(lista));
                restoreArea.style.display = 'none';
            } else {
                const backup = localStorage.getItem('backupFila');
                if (backup && JSON.parse(backup).length > 0) restoreArea.style.display = 'block';
            }
        });

        function restoreQueue() {
            const backup = localStorage.getItem('backupFila');
            if (backup) {
                socket.emit('restore-queue', JSON.parse(backup));
                restoreArea.style.display = 'none';
            }
        }
        function ignoreBackup() {
            localStorage.removeItem('backupFila');
            restoreArea.style.display = 'none';
        }
    </script>
</body>
</html>