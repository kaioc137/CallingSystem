<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Recepção - Triagem</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f4f4; padding: 20px; max-width: 800px; margin: auto; }
        .input-group { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 15px; }
        
        /* Força visualmente o input a ficar maiúsculo */
        input { text-transform: uppercase; }
        
        input, select { padding: 12px; font-size: 1.1rem; border: 1px solid #ccc; border-radius: 4px; }
        
        button { padding: 12px; background-color: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 1.1rem; }
        button:hover { background-color: #219150; }
        
        ul { list-style: none; padding: 0; margin-top: 20px; }
        li { background: white; border-bottom: 1px solid #eee; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        .tag { font-size: 0.8rem; padding: 4px 8px; border-radius: 4px; background: #eee; color: #555; font-weight: bold; text-transform: uppercase; }
        
        /* Cores das etiquetas */
        .tag.lotacao { background: #e8f8f5; color: #1abc9c; }
        .tag.ferias { background: #fef9e7; color: #f1c40f; }
        .tag.terceirizados { background: #ebf5fb; color: #3498db; }
    </style>
</head>
<body>

    <h2>RECEPÇÃO - TRIAGEM</h2>
    
    <div class="input-group">
        <label>NOME DO CIDADÃO:</label>
        <input type="text" id="nameInput" placeholder="EX: MARIA DA SILVA" autofocus>

        <label>ASSUNTO / ENCAMINHAR PARA:</label>
        <select id="sectorInput">
            <option value="estagio">ESTÁGIO (RECEPÇÃO)</option>
            <option value="terceirizados">TERCEIRIZADOS (SALA A1)</option>
            <option value="frequencia">FREQUÊNCIA (SALA A3)</option>
            <option value="lotacao">LOTAÇÃO DE PROFESSORES (SALA A4)</option>
            <option value="ferias">FÉRIAS / LICENÇAS (SALA A5)</option>
        </select>

        <button onclick="addPerson()">CADASTRAR NA FILA (+)</button>
    </div>

    <h3>FILA DE ESPERA (<span id="count">0</span>)</h3>
    <ul id="queueList"></ul>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const nameInput = document.getElementById('nameInput');
        const sectorInput = document.getElementById('sectorInput');
        const queueList = document.getElementById('queueList');

        function addPerson() {
            // Converte para MAIÚSCULO antes de enviar
            const nome = nameInput.value.trim().toUpperCase();
            
            const index = sectorInput.selectedIndex;
            const setorCodigo = sectorInput.value;
            const setorNome = sectorInput.options[index].text; 

            if (nome) {
                socket.emit('add-to-queue', { nome, setorCodigo, setorNome });
                nameInput.value = '';
                nameInput.focus();
            }
        }

        nameInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") addPerson();
        });

        socket.on('update-queue', (lista) => {
            document.getElementById('count').innerText = lista.length;
            queueList.innerHTML = "";
            
            lista.forEach((pessoa, i) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span><strong>${i + 1}.</strong> ${pessoa.nome}</span>
                    <span class="tag ${pessoa.setorCodigo}">${pessoa.setorNome}</span>
                `;
                queueList.appendChild(li);
            });
        });
    </script>
</body>
</html>