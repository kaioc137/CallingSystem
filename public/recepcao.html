<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Recep√ß√£o - Triagem</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f4f4; padding: 20px; max-width: 800px; margin: auto; }
        .input-group { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 15px; }
        
        input { text-transform: uppercase; padding: 12px; font-size: 1.1rem; border: 1px solid #ccc; border-radius: 4px; }
        select { padding: 12px; font-size: 1.1rem; border: 1px solid #ccc; border-radius: 4px; }
        
        button.btn-add { padding: 12px; background-color: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 1.1rem; }
        button.btn-add:hover { background-color: #219150; }
        
        ul { list-style: none; padding: 0; margin-top: 20px; }
        
        /* Layout da linha da lista atualizado para caber o bot√£o */
        li { 
            background: white; 
            border-bottom: 1px solid #eee; 
            padding: 10px 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .info-container { display: flex; align-items: center; gap: 10px; flex: 1; }

        .tag { font-size: 0.8rem; padding: 4px 8px; border-radius: 4px; background: #eee; color: #555; font-weight: bold; text-transform: uppercase; }
        
        /* Bot√£o de Lixeira */
        .btn-trash {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px 10px;
            border-radius: 5px;
            transition: 0.2s;
        }
        .btn-trash:hover {
            background-color: #ffebee;
            transform: scale(1.1);
        }

        /* Cores das etiquetas (opcional, mantenha se j√° usava) */
        .tag.lotacao { background: #e8f8f5; color: #1abc9c; }
        .tag.ferias { background: #fef9e7; color: #f1c40f; }
        .tag.terceirizados { background: #ebf5fb; color: #3498db; }
    </style>
</head>
<body>

    <h2>RECEP√á√ÉO - TRIAGEM</h2>
    
    <div class="input-group">
        <label>NOME DO CIDAD√ÉO:</label>
        <input type="text" id="nameInput" placeholder="EX: MARIA DA SILVA" autofocus>

        <label>ASSUNTO / ENCAMINHAR PARA:</label>
        <select id="sectorInput">
            <option value="estagio">EST√ÅGIO (RECEP√á√ÉO)</option>
            <option value="terceirizados">TERCEIRIZADOS (SALA A1)</option>
            <option value="frequencia">FREQU√äNCIA (SALA A3)</option>
            <option value="lotacao">LOTA√á√ÉO DE PROFESSORES (SALA A4)</option>
            <option value="ferias">F√âRIAS / LICEN√áAS (SALA A5)</option>
        </select>

        <button class="btn-add" onclick="addPerson()">CADASTRAR NA FILA (+)</button>
    </div>

    <div id="restoreArea" style="display: none; margin-top: 20px; padding: 15px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24;">
        <strong>‚ö†Ô∏è O servidor reiniciou!</strong><br>
        H√° uma lista salva neste computador. Deseja restaurar?
        <br><br>
        <button onclick="restoreQueue()" style="background: #c82333; color: white; border: none; padding: 8px; cursor: pointer;">RESTAURAR FILA AGORA</button>
        <button onclick="ignoreBackup()" style="background: #6c757d; color: white; border: none; padding: 8px; cursor: pointer;">Ignorar</button>
    </div>

    <h3>FILA DE ESPERA (<span id="count">0</span>)</h3>
    <ul id="queueList"></ul>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const nameInput = document.getElementById('nameInput');
        const sectorInput = document.getElementById('sectorInput');
        const queueList = document.getElementById('queueList');
        const restoreArea = document.getElementById('restoreArea');

        // PING KEEP-ALIVE
        setInterval(() => { socket.emit('ping-keep-alive'); }, 1000 * 60 * 5);

        function addPerson() {
            const nome = nameInput.value.trim().toUpperCase();
            const index = sectorInput.selectedIndex;
            const setorCodigo = sectorInput.value;
            const setorNome = sectorInput.options[index].text; 

            if (nome) {
                socket.emit('add-to-queue', { nome, setorCodigo, setorNome });
                nameInput.value = '';
                nameInput.focus();
            }
        }

        // Fun√ß√£o NOVA: Remover pessoa
        function removePerson(index) {
            if(confirm('Tem certeza que deseja remover esta pessoa da fila?')) {
                socket.emit('remove-from-queue', index);
            }
        }

        nameInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") addPerson();
        });

        socket.on('update-queue', (lista) => {
            document.getElementById('count').innerText = lista.length;
            queueList.innerHTML = "";
            
            lista.forEach((pessoa, i) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="info-container">
                        <strong>${i + 1}.</strong> ${pessoa.nome}
                        <span class="tag ${pessoa.setorCodigo}">${pessoa.setorNome}</span>
                    </div>
                    <button class="btn-trash" onclick="removePerson(${i})" title="Remover da Fila">üóëÔ∏è</button>
                `;
                queueList.appendChild(li);
            });

            // L√≥gica do Backup (Plano B)
            if (lista.length > 0) {
                localStorage.setItem('backupFila', JSON.stringify(lista));
                restoreArea.style.display = 'none'; 
            } else {
                const backup = localStorage.getItem('backupFila');
                if (backup && JSON.parse(backup).length > 0) {
                    restoreArea.style.display = 'block';
                }
            }
        });

        function restoreQueue() {
            const backup = localStorage.getItem('backupFila');
            if (backup) {
                socket.emit('restore-queue', JSON.parse(backup));
                restoreArea.style.display = 'none';
            }
        }

        function ignoreBackup() {
            localStorage.removeItem('backupFila');
            restoreArea.style.display = 'none';
        }
    </script>
</body>
</html>